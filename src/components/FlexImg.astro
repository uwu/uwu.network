---
import { getSize, rootPath } from "@res/js/fleximg-impl";
import imageSize from "image-size";
import { imageSizeFromFile } from "image-size/fromFile";
import { resolve } from "path";

interface Props {
	src: string;
	alt?: string;
	style?: string | Record<string, string>;
	targetHeight?: number;
}

const { src, alt, style, targetHeight, ...otherProps } = Astro.props;

const size = await getSize(src);

const aspectRatio = `${size.width} / ${size.height}`;

// default 25rem at 17.3333px font-size
const scale = (targetHeight ?? 25 * 17.333333) / size.height;

const newStyle = typeof style === "object"
	? { ...style, "aspect-ratio": aspectRatio, "max-width": size.width * scale + "px", width: "100%" }
	: `${style ?? ""}; aspect-ratio: ${aspectRatio}; max-width: ${size.width * scale}px; width: 100%`;
---

<img src={src} alt={alt ?? ""} style={newStyle} {...otherProps} />
