---
import IndexLayout from "#layouts/IndexLayout.astro";
import UwubpLayout from "#layouts/UwubpLayout.astro";
import { parse } from "#js/parse";
import { formatDate } from "#js/lib";
import "#css/uwubp.scss";
import Card from "#components/Card.astro";

// get all posts, import as raw files, eager makes vite provide the file content instead of an import function
const rawPosts = import.meta.glob("./_posts/*.txt", { eager: true, as: "raw" });
const posts = Object.keys(rawPosts)
    .map((path) => {
        // get the filename without extension from the file path "./_pages/something.txt" -> something
        const date = path.split("/").pop().split(".")[0];
        // get the current url -> /~alyxia/uwubp/
        const normalizedUrl = Astro.url.pathname.replace(/\/?$/, "/");

        return {
            path: normalizedUrl + date, // construct the permalink -> /~alyxia/uwubp/something
            date: formatDate(date),
            content: parse(rawPosts[path]), // parsed content
        };
    })
    .sort((a, b) => {
        return new Date(b.date).getTime() - new Date(a.date).getTime();
    });
---

<UwubpLayout>
    {
        posts.map((post) => (
            <Card fileHeader={post.date} href={post.path}>
                <Fragment set:html={post.content} />
            </Card>
        ))
    }
</UwubpLayout>

<style is:global>
    .text div {
        padding: 0;
        margin: 3ch 5ch 5ch 5ch;
    }
</style>
