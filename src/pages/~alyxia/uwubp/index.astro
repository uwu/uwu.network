---
import IndexLayout from "#layouts/IndexLayout.astro";
import { parse } from "#js/parse";
import { formatDate } from "#js/lib";
import "#css/uwubp.scss";
import Indexer from "#components/Indexer.astro";

// get all posts, import as raw files, eager makes vite provide the file content instead of an import function
const rawPosts = import.meta.glob("./_posts/*.txt", { eager: true, as: "raw" });
const posts = Object.keys(rawPosts)
    .map((path) => {
        // get the filename without extension from the file path "./_pages/something.txt" -> something
        const date = path.split("/").pop().split(".")[0];
        // get the current url -> /~alyxia/uwubp/
        const normalizedUrl = Astro.url.pathname.replace(/\/?$/, "/");

        return {
            path: normalizedUrl + date, // construct the permaling -> /~alyxia/uwubp/something
            date: formatDate(date),
            content: parse(rawPosts[path]), // parsed content
        };
    })
    .sort((a, b) => {
        return new Date(b.date).getDate() - new Date(a.date).getDate();
    });
---

<style is:global>
    .padded {
        background-color: #000;
        background-image: url(/alyxia/img/bg/login.png);
        background-attachment: fixed;
        background-position: center;
    }
    h1[style] > a {
        color: yellow;
    }

    @media screen and (max-width: 48rem) {
        h1[style],
        h1[style] > a {
            font-size: 1.2em;
        }
        .padded {
            padding: 0;
            padding-bottom: 10vw;
        }
    }
</style>

<IndexLayout>
    <Indexer />
    <div class="separator"></div>
    <div class="padded">
        <center>
            <h1 style="padding: 0.67em 0; margin: 0;">
                <a href="/~alyxia">alyxia</a>@<a href="/~alyxia/uwubp">uwubp</a>
                - Echo Chamber
            </h1>
        </center>
        <div class="padded">
            {
                posts.map((post) => (
                    <div class="blogpane">
                        <h1>
                            <a href={post.path}>{post.date}</a>
                        </h1>
                        <p>
                            <Fragment set:html={post.content} />
                        </p>
                    </div>
                ))
            }
        </div>
    </div>
</IndexLayout>
